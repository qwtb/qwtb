\documentclass[12pt,a4paper,oneside]{report} %<<<1 ------------------------------
% fonts, encoding:
\usepackage[utf8]{inputenc}             % file is in utf8:
\usepackage{cmap}                       % pdf is created with correct special characters, requires proper font, see next two lines
\usepackage[T1]{fontenc}                % see higher line
\usepackage{tgtermes}                   % high quality times font
\usepackage{textcomp}                   % proper micro sign for SI, use: \textmu, in equation: $\hbox{\textmu}$
\usepackage{slantsc}                   % proper micro sign for SI, use: \textmu, in equation: $\hbox{\textmu}$
\usepackage{calc}                   % provides \widthof
\usepackage{enumitem}                   % provides \begin{description} with settings []
\usepackage{color}                   % provides coloured text
% obrazky:
\usepackage{graphicx}                   % to insert pictures
\usepackage{grffile}                    % enables spaces in picture file names
% \grffilesetup{ multidot=false, babel=false, encoding, inputencoding=utf8, filenameencoding=utf8, space=true}
\newcommand*{\FILEDOT}{.}                   % if picture file name containt dot (e.g. aaa.bbb.pdf), then TeX considers rest as filename extension, so dot must be written as follows: \includegraphics{aaa\FILEDOT bbb.eps}
% rest:
\usepackage[pdftex,
            unicode,
            pdfauthor={Q-Wave consorcium},
            pdftitle={QWTB documentation},
            pdfkeywords={algorithm, data procesing, sampling, toolbox},
            pdfproducer={Latex with hyperref},
            pdfcreator={pdflatex}]{hyperref}
%\usepackage[a4paper]{geometry}          % ensure A4
%\geometry{verbose,lmargin=2.5cm,rmargin=2.5cm,tmargin=2.5cm,bmargin=2.5cm}      % margins settings
\usepackage{url}                        % enables \url in bibtex
%\usepackage{setspace} \doublespacing   % double line spacing, for 1.5 set \onehalfspace
\usepackage{xspace}                     % proper automatic spacing after user defined commands
\usepackage{amsmath}                    % better equations

% lstlisting settings %<<<1 ----------------------------------------------------
\usepackage{listings}                   % for source code formatting
\input{code_highlight_settings.tex}     % user defined code formatting
\newcommand{\li}[1]{\lstinline{#1}}     % instead of long \lstinline, just write \li

% bibliography settings %<<<1 ----------------------------------------------------
\usepackage[english]{babel} % main language of the document must be last
\usepackage[
   backend=biber      % if we want unicode 
  ,style=ieee   % or iso-numeric for numeric citation method          
  ,babel=other        % to support multiple languages in bibliography
  %,sortlocale=cs_CZ   % locale of main language, it is for sorting
  ,sortlocale=en_UK   % locale of main language, it is for sorting
  ,bibencoding=UTF8   % this is necessary only if bibliography file is in different encoding than main document
]{biblatex}

\bibliography{lib}
%\defbibenvironment{bibliography}
%    {\list
%        {[\printfield[labelnumberwidth]{labelnumber}]}
%        {\setlength{\labelwidth}{\labelnumberwidth}
%        \setlength{\leftmargin}{4pt}
%        \setlength{\labelsep}{10pt}
%        \addtolength{\leftmargin}{\labelsep}
%        \setlength{\itemsep}{6pt}
%        \setlength{\parsep}{\bibparsep}}
%        \renewcommand*{\makelabel}[1]{\hss##1}}
%    {\endlist}
%    {\item}

% shorts: %<<<1 ----------------------------------------------------

\def\Alg{{\sc Algorithm}\xspace}
\def\Algs{{\sc Algorithms}\xspace}
\def\Tb{{\sc Toolbox}\xspace}
\def\Da{{\sc Data}\xspace}
\def\Mea{{\sc Measurement}\xspace}
\def\Qua{{\sc Quantity}\xspace}
\def\Quas{{\sc Quantities}\xspace}
\def\Wr{{\sc Wrapper}\xspace}
\def\Wrs{{\sc Wrappers}\xspace}
\def\matlab{{\sc MATLAB}\xspace}
\def\octave{{\sc GNU Octave}\xspace}
\def\labview{{\sc LabVIEW}\xspace}
\def\mgo{\matlab/\octave\xspace}
        
\begin{document} % other document settings --------------------------------------------%<<<1
% how to devide special words, e.g. auto-mation
\hyphenation{Frame-work OpenOffice SourceForge Windows}
%\def\thesection{\Roman{section}}       % redefines numbering style of sections
\renewcommand\floatpagefraction{.9} \renewcommand\topfraction{.9} \renewcommand\bottomfraction{.9} \renewcommand\textfraction{.1} \setcounter{totalnumber}{50} \setcounter{topnumber}{50} \setcounter{bottomnumber}{50} % if too many pictures, change text/float fraction
\renewcommand{\labelitemi}{--}          % item sepparator
\setlength{\unitlength}{1mm}            % default length in picture environment

% tight description environment:
\newenvironment{tightdesc}{\begin{description}[itemsep=0pt]} 
                              {\end{description}}

% names of sections:
\def\infosection{Description}
\def\examplesection{Example}
% remove "chapter" from chapter heading:
\renewcommand{\chaptername}{}

\title{QWTB: Toolbox description}
\author{Q-Wave consorcium}

% first page ----------------------------------------------------------------------- %<<<1 ------------------------------
\thispagestyle{empty}
\begin{center}
        \vspace*{10em}
        {\huge
        \includegraphics[width=0.3\textwidth]{logo/qwtb_logo.pdf}

        \vspace{2.0em}
        QWTB documentation\\

        \vspace{1.5em}
        Toolbox description}\\

        \vfill
        {\Large \color{red}{QWTB version 0.2}}

        \vspace{1em}
        {\Large \url{https://qwtb.github.io/qwtb/}}
\end{center}
\newpage

\tableofcontents

\chapter{Introduction} %<<<1 ------------------------------
\bigskip
\begin{center}
        \parbox{0.7\textwidth}{\textit{Press a button with bold title AMPLITUDE\\
        \dots drink a coffee \dots\\
        and get the result}}
\end{center}

\bigskip
\noindent {\bf QWTB} is a toolbox for evaluation of measured data. QWTB consist of data
processing algorithms from very different sources and unificating application interface. The toolbox
gives the possibility to use different data processing algorithms with one set of data and removes
the need to reformat data for every particular algorithm. Toolbox is extensible. The toolbox
can variate input data and calculate uncertainties by means of Monte Carlo Method
(MCM)~\cite{JCGM2008}.

\bigskip
\noindent {\bf QWTBLVLib} is a set of \labview Virtual Instruments (VI) forming a library and
providing an easy link between \labview and QWTB.

\bigskip
\noindent {\bf Simple QWTB GUI} is a fully working example of using
QWTBLVLib written in \labview and forms a graphical user interface to QWTB.

\bigskip
\noindent {\bf QWTBvar} is a script to variate input quantities, multiply run algorithm inside
of QWTB, and deliver or plot results. It can be also used to precalculate results and interpolate.

\bigskip
\noindent Toolbox was realized within the EMRP-Project SIB59 Q-Wave. The EMRP is jointly funded by the EMRP
par- ticipating countries within EURAMET and the European Union.

\vfill
\includegraphics[width=0.3\textwidth]{sources/Q-Wave_logo_01.pdf}
\hfill
\includegraphics[width=0.3\textwidth]{sources/eurametlogo.jpg}


\chapter{Installation} %<<<1 ----------------------------------------
\section{QWTB \& QWTBvar} %<<<2 ----------------------------------------
The toolbox can be downloaded either as a~{\sc git} repository or as a zip archive containing
documentation and a {\tt qwtb} directory containing all scripts and algorithms. Extract
archive into a directory of your selection {\tt YourDirectory}.

Start \matlab or \octave. To use the toolbox, two methods can be used:
\begin{enumerate}
        \item Change current working directory of \matlab or \octave by command:
\end{enumerate}

\begin{lstlisting}
cd('YourDirectory/qwtb')
\end{lstlisting}

\begin{enumerate}
        \setcounter{enumi}{1}
        \item Or add toolbox directory into the search path by command:
\end{enumerate}
\begin{lstlisting}
addpath('YourDirectory/qwtb')
\end{lstlisting}

\section{QWTBLVLib} %<<<2 ----------------------------------------
Library can be downloaded either as source codes in a~{\sc git} repository or as a zip archive
containing packed project library with {\tt .lvlibp} and {\tt .dll} libraries. Extract archive into
a directory of your selection and import into your \labview project. 

\section{simple QWTB GUI} %<<<2 ----------------------------------------
Simple graphical user interace can be downloaded either as source codes in a~{\sc git} repository or
as a zip archive containing executable and required libraries. Extract archive into a directory of
your selection and run the executable file.

\chapter{Basic description of the toolbox} %<<<1 ------------------------
\section{Toolbox overall scheme} %<<<2 ------------------------------
The basic scheme of the toolbox is following:
\begin{center}
        \includegraphics{sources/basic scheme v2.pdf}
\end{center}

User have to prepare the data, either based on a real measurement or simulated, into a specified
format. If needed, user can generate randomized data for selected quantities (e.g. with special
probability density functions) and prepare for Monte Carlo uncertainty calculation. Next user calls
toolbox to apply a selected algorithm on the data and review results. Toolbox will:
\begin{enumerate}
        \item Check user data.
        \item Check or generate calculation settings.
        \item If required, quantities are randomized according uncertainties to prepare for MCM uncertainty calculation.
        \item Data are handled to a wrapper. If needed, wrapper is run multiple times according to MCM.
        \item Output data are the result of the toolbox.
\end{enumerate}

Another algorithm can be used immediately on the same data. User interface of the toolbox is represented
by the function \li{qwtb} defined in the file {\tt qwtb.m}.

\section{Toolbox use} %<<<2 ------------------------------
The toolbox is used in several modes according to a number and character of input arguments.

\subsection{Get informations of all implemented algorithms} %<<<3
\begin{lstlisting}
alginfo = qwtb()
\end{lstlisting}

With no input arguments, toolbox returns informations of all available algorithms. Result array
\li{alginfo} contains structures for every algorithm found in the same directory as
\texttt{qwtb.m}. Format of structures is defined in~\ref{structalginfo}.

This call can be also used to get \emph{standard} calculation settings used in the toolbox:
\begin{lstlisting}
[alginfo, calcset] = qwtb()
\end{lstlisting}
For use of calcset, see next chapter.

\subsection{Application of an algorithm on the data} %<<<3 ------------------------------
\begin{lstlisting}
dataout = qwtb('algid', datain)
\end{lstlisting}

The algorithm is selected by first input argument \li{algid}. It is a string with
designator of the algorithm, according structrue~\ref{structalginfo}.

The second input argument is the user data. Data have to be formatted in a structure with fields
named as quantities required by the algorithm (see~\ref{structquantity}).

The output variable is the structure with fields named as quantities.

In this case, standard calculation settings are used. If the user specifies calculation settings
in structure according~\ref{structcalcset}, it can be used as third input argument
\li{calcset}:

\begin{lstlisting}
dataout = qwtb('algid', datain, calcset)
\end{lstlisting}

For some calculation settings some fields of \li{datain} or \li{calcset} are generated
automatically. To review automatically generated fields, user can get these structure in second and
third output argument:

\begin{lstlisting}
[dataout, datain, calcset] = qwtb('algid', datain)
[dataout, datain, calcset] = qwtb('algid', datain, calcset)
\end{lstlisting}

\subsection{Running an example of algorithm use} %<<<3 ------------------------------
Algorithm can have implemented an example of the use. This can be run by following syntax:

\begin{lstlisting}
qwtb('algid', 'example')
\end{lstlisting}

The algorithm is selected by first input argument \li{algid}. It is a string with
designator of the algorithm, according structrue~\ref{structalginfo}. The second argument is a
string. Toolbox will run a script \li{alg_example.m} located in a algorithm directory.

After finish user can review input and output data or resulted figures if any.

\subsection{Running a test of algorithm} %<<<3 ------------------------------
Algorithm can have implemented a self test. This can be run by following syntax:

\begin{lstlisting}
qwtb('algid', 'test')
\end{lstlisting}

The algorithm is selected by first input argument \li{algid}. It is a string with
designator of the algorithm, according structrue~\ref{structalginfo}. The second argument is a
string. Toolbox will run a script \li{alg_test.m} located in a algorithm directory.

Test should prepare data, run algorithm and check results. If implementation of algorithm
behaves incorrectly, an error will occur.

\subsection{Get informations of algorithm} %<<<3 ------------------------------
To get informations of only the selected algorithm, following syntax is used:
\begin{lstlisting}
qwtb('algid', 'info')
\end{lstlisting}

Result structure is defined in~\ref{structalginfo}.

\subsection{Adding or removing algorithm path} %<<<3 ------------------------------
Algorithms are stored in different directories, which are not in \mgo load path. To add directory
with selected path to \mgo load path, following syntax is used:

\begin{lstlisting}
qwtb('algid', 'addpath')
\end{lstlisting}

To remove path, use:

\begin{lstlisting}
qwtb('algid', 'rempath')
\end{lstlisting}

Adding or removing path should be required only in special cases, such as debugging etc.

\subsection{Displaying license of an algorithm} %<<<3 ------------------------------------
To display a license of an algorithm, following syntax is used:
\begin{lstlisting}
license = qwtb('algid', 'license')
\end{lstlisting}
For details on licensing, see chapter~\ref{ch-license}.


\chapter{Detailed description of the toolbox} %<<<1 ------------------------------
\section{Algorithm directory structure implementation} %<<<2 ------------------------------
\label{diralg}
Every algorithm is placed in a directory of following name:
\begin{center}
        {\tt alg\_X}
\end{center}
These directories have to be located in the directory containing the toolbox main script {\tt qwtb.m}.

Every algorithm directory contains following files:
\begin{tightdesc}
        \item [{\tt X1}, {\tt X2}, \dots] ---  Mandatory. One or more files with the algorithm itself.
        \item [{\tt alg\_info.m}] ---  Mandatory. Description of the algorithm. See \ref{filealginfo}.
        \item [{\tt alg\_wrapper.m}] ---  Mandatory. Wrapper of the algorithm. See \ref{filealgwrapper}.
        \item [{\tt alg\_test.m}] ---  Recomended. Testing function. See \ref{filealgtest}.
        \item [{\tt alg\_example.m}] ---  Recomended. Example script. See \ref{filealgexample}.
\end{tightdesc}

\subsection{File {\tt alg\_info.m}} %<<<3 ------------------------------
\label{filealginfo}
File contains a function with definition:

\begin{lstlisting}
function alginfo = alg_info()
\end{lstlisting}

The output \li{alginfo} is a structure with informations about the algorithm. Structure is
defined in~\ref{structalginfo}.

File is mandatory. If file is missing in algorithm directory, QWTB will not recognize this
algorithm as part of the toolbox.

\subsection{File {\tt alg\_wrapper.m}} %<<<3 ------------------------------
\label{filealgwrapper}
File contains a function with definition:

\begin{lstlisting}
function dataout = alg_wrapper(datain, calcset)
\end{lstlisting}

The input \li{datain} is a structure with input data (see %XXX
), \li{calcset} is a structure with definition of calculation settings
(see~\ref{structcalcset}).
) and \li{dataout} is a structure containing output data (see %XXX
).

The wrapper does following:
\begin{enumerate}
        \item Formats input data structure \li{datain} into variables wuitable for algorithm.
        \item Runs the algorithm.
        \item Format results of the algorithm into data structure \li{dataout}.
\end{enumerate}

File is mandatory. If file is missing in algorithm directory, QWTB will not recognize this
algorithm as part of the toolbox.

\subsection{File {\tt alg\_test.m}} %<<<3 ------------------------------
\label{filealgtest}
File contains a function with following definition:

\begin{lstlisting}
function alg_test(calcset)
\end{lstlisting}

Test should generate sample data, run algorithm and check results by a function \li{assert}.
QWTB will provide a standard calculation settings structure \li{calcset}
(see~\ref{structcalcset}), which is used as a function input variable.

This file is not mandatory, however is recommended.

\subsection{File {\tt alg\_example.m}} %<<<3 ------------------------------
\label{filealgexample}

Example contains a script showing a basic use of the algorithm. The format of the file should
conform to the publishing markup defined in Matlab documentation. See matlab help on keyword
\emph{Publishing markup}). The QWTB runs this script in base context, thus all variables defined in
the example script will be accessible to the user.

To create a documentation of the QWTB, function \li{publish} is applied to the example script
and resulting file is attached to the documentation file.

\subsection{Overall flow chart} %<<<3 ----------------------------------------
The main toolbox file {\tt qwtb.m} calls files in algorithm directory according following flow
chart:
\begin{center}
        \includegraphics[width=1.0\textwidth]{sources/outer_flowchart.pdf}
\end{center}
Red arrow marks recursion, blue box represents files of the algorithm itself, green boxes represents
files required or recommended by the toolbox.

\section{Algorithm informations structure} %<<<2 ------------------------------
\label{structalginfo}
Structure defines properties and possibilities of the algorithm. All fields are mandatory but
\li{.fullpath}.

\begin{tightdesc}
        \item [\textsf{.id}] --- Designator of the algorithm.
        \item [\textsf{.name}] ---  Name of the algorithm.
        \item [\textsf{.desc}] ---  Basic description.
        \item [\textsf{.citation}] ---  Reference.
        \item [\textsf{.remarks}] ---  Any remark.
        \item [\textsf{.license}] ---  License of the algorithm.
        \item [\textsf{.inputs}] ---  Input quantities definitions.
        \item [\textsf{.outputs}] ---  Output quantities definitions.
        \item [\textsf{.providesGUF}] ---  Algorithm/wrapper calculates GUF uncertainty.
        \item [\textsf{.providesMCM}] ---  Algorithm/wrapper calculates MCM uncertainty.
        \item [\textsf{.fullpath}] ---  Full path to the algorithm. Automatically generated by the toolbox.
\end{tightdesc}

\subsection{\textsf{.id}} %<<<3 ------------------------------
\label{structalginfoid}
String. Designator of the algorithm. It is unique identifier, no two algorithms can have same id.

\subsection{\textsf{.name}} %<<<3 ------------------------------
\label{structalginfoname}
String. Full name of the algorithm. 

\subsection{\textsf{.desc}} %<<<3 ------------------------------
\label{structalginfodesc}
String. Basic description of the algorithm.

\subsection{\textsf{.citation}} %<<<3 ------------------------------
\label{structalginfocitation}
String. A reference to the paper, book or other literature with full description of the algorithm.

\subsection{\textsf{.remarks}} %<<<3 ------------------------------
\label{structalginforemarks}
String. Remarks or others related to the algorithm.

\subsection{\textsf{.license}} %<<<3 ------------------------------
\label{structalginfolicense}
String. License of the algorithm. This is not license of the toolbox but of the algorithm!

\subsection{\textsf{.inputs}} %<<<3 ------------------------------
\label{structalginfoinputs}
Array of structures. Every structure define an input quantity. Structure has following mandatory
fields:
\begin{tightdesc}
        \item [\textsf{.name}] --- Name of input quantity.
        \item [\textsf{.desc}] --- Description of input quantity.
        \item [\textsf{.alternative}] --- Index of group of alternative quantities.
        \item [\textsf{.optional}] --- Sets quantity to be optional.
        \item [\textsf{.parameter}] --- Sets quantity to be a parameter.
\end{tightdesc}

\subsubsection{\textsf{.name}} %<<<4 ------------------------------
String. Name of input quantity.

\subsubsection{\textsf{.desc}} %<<<4 ------------------------------
String. Short description of input quantity.

\subsubsection{\textsf{.alternative}} %<<<4 ------------------------------
Integer. Index of group of alternative quantities. If several input quantities has the same index,
QWTB requires only one of quantities in the group. If set to zero, quantity is not part of any group.

For example, suppose a sampling time \li{Ts} and sampling frequency \li{fs} has the same
index. The algorithm requires \li{fs}, but the wrapper can calculate \li{fs} 
from \li{Ts}. User can supply only \li{fs} to run the algorithm. But he can also supply
only the \li{Ts} and the wrapper calculates \li{fs} from \li{Ts} and runs the algorithm. The
wrapper should always notice the user that some quantity was calculated from other one. If user
supplies both, the wrapper should choose the quantity most suitable for the algorithm.

\subsubsection{\textsf{.optional}} %<<<4 ------------------------------
Boolean. If set, the quantity is optional. The QWTB do not require user to supply this quantity. If
quantities are part of a group of alternative quantities, the group itself is considered optional
only if all quantities are optional.

\subsubsection{\textsf{.parameter}} %<<<4 ------------------------------
Boolean. If set, the quantity is considered as optional. This means the quantity do not have to be a
number and is not randomized by QWTB.
% XXX is parameter always optional or not? I think this is not finished in qwtb.m

\subsection{\textsf{.outputs}} %<<<3 ------------------------------
\label{structalginfooutputs}
Array of structures. Every structure define an output quantity. Structure has following mandatory
fields:
\begin{tightdesc}
        \item [\textsf{.name}] --- Name of output quantity.
        \item [\textsf{.desc}] --- Description of output quantity.
\end{tightdesc}

\subsubsection{\textsf{.name}} %<<<4 ------------------------------
String. Name of output quantity.

\subsubsection{\textsf{.desc}} %<<<4 ------------------------------
String. Short description of output quantity.

\subsection{\textsf{.providesGUF}} %<<<3 ------------------------------
\label{structalginfoprovidesGUF}
Boolean. If nonzero, the wrapper or the algorithm calculates uncertainty by means of GUM Uncertainty
Framework.

\subsection{\textsf{.providesMCM}} %<<<3 ------------------------------
\label{structalginfoprovidesMCM}
Boolean. If nonzero, the wrapper or the algorithm calculates uncertainty by means of Monte Carlo
Method.

\subsection{\textsf{.fullpath}} %<<<3 ------------------------------
\label{structalginfofullpath}
String. Full path to the algorithm. This field is automatically generated by QWTB and should not be
part of {\tt alg\_test.m}.

\section{Quantity structure} %<<<2 ------------------------------
\label{structquantity}
Every quantity is a structure with following fields:
\begin{tightdesc}
        \item [\textsf{.v}] --- Value.
        \item [\textsf{.u}] --- Uncertainty.
        \item [\textsf{.d}] --- Degree of freedom.
        \item [\textsf{.c}] --- Correlation.
        \item [\textsf{.r}] --- Randomized uncertainty.
\end{tightdesc}

\subsection{\textsf{.v}} %<<<3 ------------------------------
\label{structquantityv}
Value of the quantity. Can be a scalar, vector or matrix. More dimensions are not
supported. 

Vectors should be ordered in a single \emph{row}. If the vector is ordered in a collumn,
it is automatically transposed and a warning is generated. Other fields (\textsf{.u},
\textsf{.d}, \textsf{.r}) are transposed if needed to match the value of the quantity.

\subsection{\textsf{.u}} %<<<3 ------------------------------
\label{structquantityu}
Standard uncertainty of the quantity. Dimensions are the same as of the value field.

\subsection{\textsf{.d}} %<<<3 ------------------------------
\label{structquantityd}
Degrees of freedom the uncertainty according GUM Uncertainty Framework. Dimensions are the same as of the value field.

This field is automatically generated by the toolbox if missing, required and \li{calcset.dof.gen}
is set to nonzero. The value will be set to 50.

\subsection{\textsf{.c}} %<<<3 ------------------------------
\label{structquantityc}
Correlation matrix for quantity. 2DO XXX.

This field can be automatically generated by the toolbox if missing, required and \li{calcset.cor.gen}
is set to nonzero. The value will be set to 0.

\subsection{\textsf{.r}} %<<<3 ------------------------------
\label{structquantityr}
Randomized uncertainties according Monte Carlo method. In the case of scalar quantity it is
\emph{column} vector of length equal to \li{calcset.mcm.repeats}. For a vector quantity it is a matrix with number
of columns equal to length of value of the quantity and number of rows equal to
\li{calcset.mcm.repeats}. For a matrix quantity it is a matrix with three dimensions, first
two equal to the dimensions of value quantity, third dimension equal to
\li{calcset.mcm.repeats}.

This field is required if Monte Carlo uncertainty calculation is required. In this case it can be
automatically generated by the toolbox if missing and \li{calcset.mcm.randomize} is set to
boolean. The pdf will be normal, sigma will be equal to the standard uncertainty of the quantity.

\subsection{Quantity structure examples} %<<<3 ------------------------------
Example of scalar quantity of mean value 1, standard uncertainty 0.1, degrees of freedom 9, correlation has no
sense for scalar quantity, and radnomized matrix has number of elements equal to \li{calcset.mcm.randomize}.
\begin{eqnarray*}
        \text{\textsf{.v}:} &(1)\\
        \text{\textsf{.u}:} &(0.1)\\
        \text{\textsf{.d}:} &(9)\\
        \text{\textsf{.c}:} &(0)\\
        \text{\textsf{.r}:} &\begin{pmatrix}
                1.02076 \\
                1.22555 \\
                \vdots\\
                0.89727 \\
        \end{pmatrix}\\
\end{eqnarray*}

Example of vector quantity with $i$ elements, $M$ is equal to \li{calcset.mcm.randomize} (only symbolic representation):
\begin{eqnarray*}
        \text{\textsf{.v}:} & (v_1, v_2, \dots, v_i) \\
        \text{\textsf{.u}:} & (u_1, u_2, \dots, u_i) \\
        \text{\textsf{.d}:} & (d_1, d_2, \dots, d_i) \\
        \text{\textsf{.c}:} & \left(    \begin{array}{ccc}
                                                c_{11}  & \hdots & c_{1i} \\
                                                \vdots  & \ddots & \vdots \\
                                                c_{i1}  & \hdots & c_{ii} \\
                                        \end{array}\right) \\
        \text{\textsf{.r}:} & \left(    \begin{array}{ccc}
                                                r_{11}  & \hdots & r_{1i} \\
                                                \vdots  & \ddots & \vdots \\
                                                r_{M1}  & \hdots & r_{Mi} \\
                                        \end{array}\right) \\
\end{eqnarray*}

Example of matrix quantity with $i$ times $j$ elements, $M$ is equal to \li{calcset.mcm.randomize} (only symbolic representation):
\begin{eqnarray*}
        \text{\textsf{.v}:} & \left(    \begin{array}{ccc}
                                                v_{11}  & \hdots & v_{1j} \\
                                                \vdots  & \ddots & \vdots \\
                                                v_{i1}  & \hdots & v_{ij} \\
                                        \end{array}\right) \\
        \text{\textsf{.u}:} & \left(    \begin{array}{ccc}
                                                v_{11}  & \hdots & u_{1j} \\
                                                \vdots  & \ddots & \vdots \\
                                                u_{i1}  & \hdots & u_{ij} \\
                                        \end{array}\right) \\
        \text{\textsf{.d}:} & \left(    \begin{array}{ccc}
                                                d_{11}  & \hdots & d_{1j} \\
                                                \vdots  & \ddots & \vdots \\
                                                d_{i1}  & \hdots & d_{ij} \\
                                        \end{array}\right) \\
        \text{\textsf{.c}:} & \left(    XXX??? \right) \\
        \text{\textsf{.r}:} & \left(    \begin{array}{ccc}
                                                r_{111}  & \hdots & r_{1j1} \\
                                                \vdots  & \ddots & \vdots \\
                                                r_{i11}  & \hdots & r_{ij1} \\
                                        \end{array}\right) \\
                            & \qquad\vdots                        \\
                            & \left(    \begin{array}{ccc}
                                                r_{11M}  & \hdots & r_{1jM} \\
                                                \vdots  & \ddots & \vdots \\
                                                r_{i1M}  & \hdots & r_{ijM} \\
                                        \end{array}\right) \\
\end{eqnarray*}

\section{Calculation settings structure} %<<<2 ------------------------------
\label{structcalcset}
Structure defines calculation methods.
\begin{tightdesc}
        \item [\textsf{.strict}] ---  (0) If zero, other fields generated automatically.
        \item [\textsf{.verbose}] ---  (1) Display various informations.
        \item [\textsf{.checkinputs}] ---  (0) Check if inputs are proper.
        \item [\textsf{.unc}] ---  ('none') How uncertainty is calculated ('none', 'guf', 'mcm').
        \item [\textsf{.loc}] ---  (0.6827) Required level of confidence of output uncertainties (0 $>$ \text{loc} $>$ 1 ).
        \item [\textsf{.cor.req}] ---  (0) Correlation matrix is required for all input quantities.
        \item [\textsf{.cor.gen}] ---  (1) Zero correlation matrix is generated automatically if missing.
        \item [\textsf{.dof.req}] ---  (0) Degrees of freedom are required for all input quantities.
        \item [\textsf{.dof.gen}] ---  (1) Degree of freedom are generated automatically if missing with value 50.
        \item [\textsf{.mcm.repeats}] ---  (100) Number of Monte Carlo iterations.
        \item [\textsf{.mcm.verbose}] ---  (1) Display various informations concerning Monte Carlo method.
        \item [\textsf{.mcm.method}] ---  ('singlecore') Parallelization method ('multicore', 'multistation').
        \item [\textsf{.mcm.procno}] ---  (0) Number of processors to use.
        \item [\textsf{.mcm.tmpdir}] ---  ('.') Directory for temporary data.
        \item [\textsf{.mcm.randomize}] ---  (1) Randomized uncertainties are generated automatically if missing.
        \item [\textsf{.var.dir}] ---  ('VAR') Only for QWTBvar: Directory for calculations.
        \item [\textsf{.var.fnprefix}] ---  ('var') Only for QWTBvar: Prefix for filenames.
        \item [\textsf{.var.cleanfiles}] ---  ('0') Only for QWTBvar: Removes files from previous calculations.
        \item [\textsf{.var.smalloutput}] ---  ('1') Only for QWTBvar: Minimize size of output files.
        \item [\textsf{.var.method}] ---  ('singlecore') Only for QWTBvar: Parallelization method ('multicore', 'multistation').
        \item [\textsf{.var.procno}] ---  (1) Only for QWTBvar: Number of processors to use.
        \item [\textsf{.var.chunks\_per\_proc}] --- (1) Only for QWTBvar: Number of calculation jobs per process.
\end{tightdesc}

\subsection{\textsf{.strict}} %<<<3 ------------------------------
\label{structcalcsetstrict}
Boolean, default value 0. If set to zero, all other fields of the structure are generated
automatically and set to a default value.

\subsection{\textsf{.verbose}} %<<<3 ------------------------------
\label{structcalcsetverbose}
Boolean, default value 1. If set to non-zero value, various messages are displayed during
calculation, such as used uncertainty calculation method, automatic generation of matrices etc.

\subsection{\textsf{.checkinputs}} %<<<3 ------------------------------
\label{structcalcsetverbose}
Boolean, default value 1. If set to zero, all checks of inputs (calculation settings, input data)
are skipped. However if inputs are not proper, various undocumented errors can happen. This option
can be used to speed up qwtb processing. About 13~ms of processing time can be saved for algorithm
with 30 input quantities (measured at iCore 5, GNU Octave 4.2.2). User have to be sure all inputs
conform proper format and contain all needed data.

% Timing testing results:
% wrapper without anything: 2.2e-5
% addpath takes about 0.005
%       clear time_addpath; for i = 1:1e3; rmpath('alg_TST'); a=tic; addpath('alg_TST'); tmp=toc(a), time_addpath(i)=tmp; endfor
% rmpath takes approx. the same time, slightly faster.
% path(X, path) takes about 0.039724
% path() takes 0.003
% path(originalpaths) takes about 0.06
% exist takes about 6e-5 s to check existence of function
% which takes about 2e-3 s
% which of nonexisting takes about 0.002 s
% 
% timing qwtb:
%       for i = 1:29; eval(['DI.x' num2str(i) '.v=' num2str(i)]); endfor
%       [tmp CS]=qwtb
%       CS.checinputs = 0; clear time_qwtb; for i = 1:1e3; a=tic; DO = qwtb('TST',DI, CS); tmp=toc(a), time_qwtb(i)=tmp; endfor
% 
% path to algorithm is already set in userspace , no checkinputs: mean = 3.1044e-04, std 1e-4
% path to alg. is not set in userspace: mean 0.0043346, std 1e-3
% so if path is set in userspace, most of the time takes addpath and rmpath, that is goooooooooooooooooooooood
% for checkinputs=1, path not set in userspace: mean 0.017 std 0.002



\subsection{\textsf{.unc}} %<<<3 ------------------------------
\label{structcalcsetunc}
String, default value 'none'. Determines uncertainty calculation method. Only three values are possible:
\begin{tightdesc}
        \item [\textsf{'none'}] ---  Uncertainty is not calculated.
        \item [\textsf{'guf'}] ---  Uncertainty is calculated by GUM Uncertainty Framework~\cite{JCGM1995}.
        \item [\textsf{'mcm'}] ---  Uncertainty is calculated by Monte Carlo Method~\cite{JCGM2008}.
\end{tightdesc}
See chapter XXX %XXX
for uncertainty calculation details.

\subsection{\textsf{.loc}} %<<<3 ------------------------------
\label{structcalcsetloc}
Number, default value 0.6827. Determines required level of confidence for output uncertainties. If
set to 0.6827, uncertainties are calculated for coverage factor 1 (for the case of normal probability
density function). Value 0.9545 correspond to a coverage factor 2. Value of loc is respected if
uncertainty is calculated by the toolbox. If the uncertainty is calculated by the algorithm itself,
one should check capabilities of the algorithm. Currently only standard uncertainties (68.27\%) are
supported. %XXX 2DO XXX

\subsection{\textsf{.cor}} %<<<3 ------------------------------
\label{structcalcsetcor}
Structure sets handling of correlation matrices of quantities. Structure has two fields:
\begin{tightdesc}
        \item [\textsf{.req}] ---  Boolean, default value 0. If non-zero, correlation matrices are required for all quantities.
        \item [\textsf{.gen}] ---  Boolean, default value 1. If non-zero, correlation matrices will be generated
        automatically if missing in quantity.
\end{tightdesc}
Automatically generated correlation matrices has all elements of zero value.

\subsection{\textsf{.dof}} %<<<3 ------------------------------
\label{structcalcsetdof}
Structure sets handling of degrees of freedom of quantities. Structure has two fields:
\begin{tightdesc}
        \item [\textsf{.req}] ---  Boolean, default value 0. If non-zero, degrees of freedom are required for all quantities.
        \item [\textsf{.gen}] ---  Boolean, default value 1. If non-zero, degree of freedom will be generated
        automatically if missing in quantity.
\end{tightdesc}
Automatically generated degree of freedom has value 50.

\subsection{\textsf{.mcm}} %<<<3 ------------------------------
\label{structcalcsetmcm}
Structure sets handling of Monte Carlo calculation of uncertainties. Structure has following fields:
\begin{tightdesc}
        \item [\textsf{.repeats}] ---  Positive non-zero integer, default value 100. Number of iterations of Monte Carlo method.

        \item [\textsf{.verbose}] ---  Boolean, default value 1. If set to non-zero value, various messages
        are displayed during calculation of Monte Carlo method such as used parallelization method,
        number of calculated iterations etc.

        \item [\textsf{.method}] ---  String, default value 'singlecore'. Parallelization method used for Monte
        Carlo method calculation. Only three values are possible:
        \begin{tightdesc}
                \item [\textsf{'singlecore'}] ---  No parallelization, all is calculated on one CPU core.
                \item [\textsf{'multicore'}] ---  Calculation is divided into cores of one computer.
                \item [\textsf{'multistation'}] ---  Calculation is distributed on several computers.
        \end{tightdesc}
        Not all methods are possible to use on all computers. 'singlecore' is always possible to
        use. 'multicore' use parfor in Matlab or parcellfun in GNU Octave. 'multistation' use %XXX

        \item [\textsf{.procno}] ---  Zero or positive integer, default value 0. Number of CPU cores exploitable
        by the parallelization method \textsf{'multicore'}. If set to zero, all available CPU cores will be used. If
        desktop computer is used, it is good practice to set to number of CPU cores minus one, so
        the computer can be used by other task also. 
        Works only in \octave.

        \item [\textsf{.tmpdir}] ---  String, default value '.' (current directory). Temporary directory for
        storing temporary data needed for some parallelization methods. %XXX which ones?

        \item [\textsf{.randomize}] ---  Boolean, default value 1. If non-zero, randomized uncertainties will be
        generated automatically if missing, but only if uncertainty calculation method is set to
        'mcm' (Monte Carlo) to prevent large memory usage.
\end{tightdesc}

\subsection{\textsf{.var}} %<<<3 ------------------------------
\label{structcalcsetvar}
Structure sets properties only for QWTBvar. Structure has following fields:
\begin{tightdesc}
        \item [\textsf{.dir}] ---  String, default value 'VAR'. All files
        needed for QWTBvar calculations will be saved into the selected
        directory. If path does not exist, it is created.
        \item [\textsf{.fnprefix}] ---  String, default value 'var'. All file
        names needed for QWTBvar calculations will start with this prefix.
        \item [\textsf{.cleanfiles}] ---  Boolean, default value 0. Job files
            and results from previous QWTBvar calculation will be deleted. Do
            not use if continuation of previously interrupted calculation is
            required.
        \item [\textsf{.smalloutput}] ---  Boolean, default value 1. If set,
            QWTBvar will not save all results of the calculations. Fields
            \li{.c} and \li{.r} of the input and output quantities will be
            removed to minimize size of files with results. Check algorithms if
            these fields are needed.
        \item [\textsf{.method}] ---  String, default value 'singlecore'. Parallelization method used for 
        QWTBvar calculations. Only three values are possible:
        \begin{tightdesc}
                \item [\textsf{'singlecore'}] ---  No parallelization, all is calculated on one CPU core.
                \item [\textsf{'multicore'}] ---  Calculation is divided into cores of one computer.
                \item [\textsf{'multistation'}] ---  Calculation is distributed on several computers.
        \end{tightdesc}
        Not all methods are possible to use on all computers. 'singlecore' is always possible to
        use. 'multicore' use parfor in Matlab or parcellfun in GNU Octave. 'multistation' use %XXX
        Be carefull when setting this parameter together with Monte Carlo
        calculations. Bad settings can result in very large number of
        processes.
        \item [\textsf{.procno}] ---  Zero or positive integer, default value 0. Number of CPU cores exploitable
        by the parallelization method \textsf{'multicore'}. If set to zero, all available CPU cores will be used. If
        desktop computer is used, it is good practice to set to number of CPU cores minus one, so
        the computer can be used by other task also. 
        Works only in \octave.
        \item [\textsf{.chunks\_per\_proc}] --- Positive non-zero integer,
        default value 1. Specifies number of calculations proceeded by one
        process. Higher number decreases number of job files on the disk and
        usage of the disk by the system.
\end{tightdesc}


%\section{qwtb.m subfunctions list} %<<<2 ----------------------------------------
%Short list and descriptions of subfunctions in {\tt qwtb.m} file:
% XXX 2DO

\section{qwtb.m flow chart} %<<<2 ----------------------------------------
Following figure shows flow chart inside of {\tt qwtb.m} file with subfunctions.
\begin{center}
        \includegraphics[width=1.2\textwidth, angle=90]{sources/inner_flowchart.pdf}
\end{center}

\newpage
Following figure shows dependencies of the {\tt qwtb.m} file.
\begin{center}
        \includegraphics[width=1.4\textwidth, angle=90]{sources/dependencies.pdf}
\end{center}


\section{How uncertainty calculation works} %<<<2 ----------------------------------------
%2DO


\section{How to add a new algorithm} %<<<2 ----------------------------------------
%2DO
To add a new algorithm, several steps have to be done.

\begin{enumerate}
        \item Select an algorithm ID. Usually it is an acronym or abbreviation of the new algorithm name.

        \item Create a directory named {\tt alg\_SOMEID}, where {\tt SOMEID} is a selected ID. For a
        directory structure, see~\ref{diralg}.

        \item Put all files required by the algorithm (i.e. scripts, libraries) into the directory
        {\tt alg\_SOMEID/}.

        \item Create a file {\tt alg\_SOMEID/alg\_info.m}. An example of such file follows.
        \begin{lstlisting} %<<<3
        function info = alg_info() 
        % Part of QWTB. Info script for algorithm SOMEALG.
        %
        % See also qwtb

        info.id = 'SOMEID';
        info.name = 'SOMEALG';
        info.desc = 'SOMEID is an super mega hyper algorithm for calculation of the ultimate answer to everything.';
        info.citation = 'Some nifty paper in some super journal.';
        info.remarks = 'Very simple implementation';
        info.license = 'MIT License';
        info.inputs(1).name = 'a';
        info.inputs(1).desc = 'Some important input';
        info.inputs(1).alternative = 0;
        info.inputs(1).optional = 0;
        info.inputs(1).parameter = 0;
        info.inputs(2).name = 'b';
        info.inputs(2).desc = 'Some other input ';
        info.inputs(2).alternative = 0;
        info.inputs(2).optional = 0;
        info.inputs(2).parameter = 0;
        info.outputs(1).name = 'x';
        info.outputs(1).desc = 'Some output';
        info.outputs(2).name = 'y';
        info.outputs(2).desc = 'Other output';
        info.providesGUF = 1;
        info.providesMCM = 0;
        \end{lstlisting} %>>>3

        \item Create a wrapper for the algorithm in a file {\tt alg\_SOMEID/alg\_wrapper.m}, see~\ref{filealgwrapper}. An example of simple wrapper
        file follows.
        \begin{lstlisting} %<<<3
        function dataout = alg_wrapper(datain, calcset)
        % Part of QWTB. Wrapper script for algorithm SOMEALG.
        %
        % See also qwtb

        % Format input data
        % SOMEALG definition is:
        % function [x, y, z] = SOMEALG(a, b);
        a = datain.a.v;
        b = datain.b.v;

        % Call algorithm
        [x, y, z] = SOMEALG(a, b);

        % Format output data:
        dataout.x.v = x;
        dataout.y.v = y;
        dataout.z.v = z;

        end % function
        \end{lstlisting} %>>>3

        \item Put a license of the algorithm into the file {\tt alg\_SOMEID/LICENSE.txt}.

        \item Create a testing script {\tt alg\_SOMEID/alg\_test.m}. This is optional, however
        recomended. An example follows.
        \begin{lstlisting} %<<<3
        function alg_test(calcset)
        % Part of QWTB. Test script for algorithm SOMEALG
        %
        % See also qwtb

        % Generate sample data 
        DI = [];
        U = 1; V = 2;
        DI.a.v = [U:V];
        DI.b.v = U/V;

        % Call algorithm
        DO = qwtb('SOMEID', DI);

        % Check results 
        assert((DO.x.v > U.*(1-1e6)) & (DO.x.v < U.*(1+1e6)));
        assert((DO.y.v > V.*(1-1e6)) & (DO.y.v < V.*(1+1e6)));
        assert((DO.z.v > sqrt(U).*(1-1e6)) & (DO.z.v < sqrt(U).*(1+1e6)));

        end % function
        \end{lstlisting}

        \item Create an example script {\tt alg\_SOMEID/alg\_example.m}. This is optional, however
        recomended. An example follows.
        \begin{lstlisting}
        %% SOMEALGNAME
        % Example for algorithm SOMEID.
        %
        % SOMEID is an super mega hyper algorithm for calculation of the ultimate answer to
        % everything.
        %

        %% Generate sample data
        % Two quantities are prepared: |a| and |b|, representing something and something even more
        % important.
        DI = [];
        U = 1; V = 2;
        DI.a.v = [U:V];
        DI.b.v = U/V;

        %% Call algorithm
        % Use QWTB to apply algorithm |SOMEID| to data |DI|.
        CS.verbose = 1;
        DO = qwtb('SOMEID', DI, CS);

        %% Display results
        % Results is the very answer.
        x = DO.x.v
        y = DO.y.v
        z = DO.z.v
        %%
        % Errors of estimation in parts per milion:
        xerrppm = (DO.x.v - U)/U .* 1e6
        yerrppm = (DO.y.v - V)/V .* 1e6
        zerrppm = (DO.z.v - sqrt(U)/sqrt(U) .* 1e6
        \end{lstlisting} %>>>3

        \item Check and test everything. Send your contribution to qwtb authors. Ask them to
        generate a new documentation. Celebrate.

\end{enumerate}

\chapter{QWTBvar} %<<<1 ----------------------------------------
QWTBvar is a script used to variate input quantities, run algorithm or user
function for all combinations of inputs, and evaluate or plot results.

User have to define values of input quantities, values of variated input
quantities and algorithm or user function to run.

After finish of the calculations, user can obtain results, plot them, or
convert the results to Look up table (LUT). LUT can be used to interpolate
results and quickly estimate outputs without calculating the results again.

\section{QWTBvar use} %<<<2 ----------------------------------------
\subsection{Run calculation}
\label{S:QWTBvar:calc}
The main usage is repeated run of QWTB calling algorithm \li{algid}:
\begin{lstlisting}
[jobfn] = qwtbvar('calc', 'algid', datain, datainvar, [calcset])
\end{lstlisting}
The structure \li{datain} contains nominal values of input quantities,
the same as when using QWTB, see~\ref{structalginfo}.

The structure \li{datainvar} contains multiple values of input quantities that
will be variated for different runs of QWTB (see \ref{S:QWTBvar:datainvar}).

If \li{datainvar} contains more input quantities, QWTBvar will make all
possible permutations.

Settings for the calculations is defined in \li{calcset}
(see~\ref{structcalcset}). For QWTBvar, only sub-structure \li{calcset.var} is
important. The rest is transferred to QWTB.

The output \li{jobfn} is a path to a file with stored informations
needed to perform calculations.

\subsection{Continue interrupted calculation}
\label{S:QWTBvar:cont}
\begin{lstlisting}
[jobfn] = QWTBVAR('cont', jobfn)
\end{lstlisting}
Continues interrupted calculation according calculation plan \li{jobfn}.
QWTBvar will read all settings and calculation plan, check what is already
calculated and will finish calculations.

\subsection{Calculate particular job}
\label{S:QWTBvar:job}
\begin{lstlisting}
[jobfn] = QWTBVAR('job', jobfn, jobids)
\end{lstlisting}
Mostly internal use. Calculates actual calculation job or multiple calculation
jobs listed in \li{jobids}. This is useful for distribution of the work for
parallel processing.

\subsection{Get result}
\label{S:QWTBvar:result}
\begin{lstlisting}
[ndres, ndresc, ndaxes, consts] = QWTBVAR('result', jobfn, [consts])
\end{lstlisting}
Obtain calculated output quantities from calculation \li{jobfn}.
Optionally, the varied input quantities can be set to the values in
\li{const} and output matrices will be sliced.

Output \li{ndres} contains structure of n-dimensional matrices with
output quantities. Output \li{ndresc} contains cell of structures with particular results.
Output \li{ndaxes} contains values for dimensions (axes) of
\li{ndres} and \li{ndresc}. These \emph{axes} are the same as the
varied quantities. See~\ref{S:QWTBvar:ndres} and~\ref{S:QWTBvar:consts}.

\subsection{Plot result in 2D}
\label{S:QWTBvar:plot2D}
\begin{lstlisting}
[H, x, y] = QWTBVAR('plot2D', jobfn, varx, vary, [consts])
\end{lstlisting}
Plots dependence of output quantity \li{vary} on varied input quantity
\li{varx} in 2-dimensional plot, based on results in \li{jobfn}.
Fills in properly title and axes labels. If results contain more varied
quantities than \li{varx}, multiple dependences are plotted.
If only one dependence is sought, the values of other varied input quantities
can be defined in \li{consts}.

Output \li{H} is a handle to the figure. Outputs \li{x} and \li{y} are
structures containing the plotted values and relevant labels
(see~\ref{S:QWTBvar:plotdata}).

\subsection{Plot result in 3D}
\label{S:QWTBvar:plot3D}
\begin{lstlisting}
[H, x, y, z] = QWTBVAR('plot3D', jobfn, varx, vary, [consts])
\end{lstlisting}
Plots dependence of output quantity \li{vary} on varied input quantity
\li{varx} in 3-dimensional plot, based on results in \li{jobfn}.
Fills in properly title and axes labels. If results contain more varied
quantities than \li{varx}, multiple dependences are plotted.
If only one dependence is sought, the values of other varied input quantities
can be defined in \li{consts}.

Output \li{H} is a handle to the figure. Outputs \li{x}, \li{y} and \li{z} are
structures containing the plotted values and relevant labels
(see~\ref{S:QWTBvar:plotdata}).


\subsection{Create look-up table}
\label{S:QWTBvar:lut}
\begin{lstlisting}
[lut] = QWTBVAR('lut', jobfn, axset, rqset)
\end{lstlisting}
Create look-up table based on the results of the job specified in input
\li{jobfn}.
Settings of the axis are defined in structure \li{axset}.
Settings of the output quantity are defined in structure \li{rqset}.
QWTBvar will create a n-dimensional look-up table of the results. Number of
dimensions is equal to the number of varied inputs. Interpolation methods for
all varied quantities (axes) has to be defined together with description of
boundary cases.

\subsection{Interpolate look-up table}
\label{S:QWTBvar:interp}
\begin{lstlisting}
[ival] = QWTBVAR('interp', lut, ipoint)
[ival] = QWTBVAR('interp', lutfn, ipoint)
\end{lstlisting}
Interpolate output quantity \li{Q} at point \li{ipoint} using
look-up table \li{lutfn}.

\section{QWTBvar workflow}
\begin{enumerate}
    \item Select either QWTB algorithm or a user-defined script \li{'algid'}.
    \item Create new structure with all needed input quantities and set values \li{datain}.
    \item Create new structure with varied input quantities \li{datainvar} and set a range of values.
    \item Run calculation of all results using \ref{S:QWTBvar:calc}.
    \item If calculation was interrupted, continue using \ref{S:QWTBvar:cont}.
    \item Obtain results of the calculation using \ref{S:QWTBvar:result}.
    \item Plot results of the calculation using \ref{S:QWTBvar:plot2D} or \ref{S:QWTBvar:plot3D}.
    \item Prepare a look-up table using \ref{S:QWTBvar:lut}.
    \item Interpolate output quantity without actual calculation using \ref{S:QWTBvar:interp}.
\end{enumerate}

\section{Structure with varied quantities \tt datainvar}
\label{S:QWTBvar:datainvar}
Structure \li{datainvar} should contain only the quantities that should be varied by QWTBvar.
Every field of the quantity in
\li{datainvar} (e.g. \li{.v}, \li{.u} etc.) must contain
one more dimension than the value of the same quantity in \li{datain}. If
input quantity in \li{datainvar} is a vector, than input quantity in
\li{datain} must be scalar. Matrix in \li{datainvar} means
\li{datain} contains vector, etc.

QWTBvar will slice the input quantity in \li{datainvar} and one after
another set this sliced value into input quantity \li{datain}.

\subsection{Example with scalar quantity}
Consider scalar input quantity \li{x}:
\begin{eqnarray*}
    \text{\textsf{.v}:} & (v_1)\\
    \text{\textsf{.u}:} & (u_1)\\
\end{eqnarray*}
If only value of the input quantity \li{x} should be varied, than
\li{datainvar} must be of following:
\begin{eqnarray*}
    \text{\textsf{.v}:} & (v_1, v_2, \dots, v_i)\\
    \text{\textsf{.u}:} & (u_1)\\
\end{eqnarray*}
QWTBvar will do $i$ calculations (or more if other quantities will be varied).

If only uncertainty of the input quantity \li{x} should be varied, than
\li{datainvar} must be of following:
\begin{eqnarray*}
    \text{\textsf{.v}:} & (v_1)\\
    \text{\textsf{.u}:} & (u_1, u_2, \dots, u_j)\\
\end{eqnarray*}
QWTBvar will do $j$ calculations (or more if other quantities will be varied).

If both value and uncertainty has to be varied by QWTBvar:
\begin{eqnarray*}
    \text{\textsf{.v}:} & (v_1, v_2, \dots, v_i)\\
    \text{\textsf{.u}:} & (u_1, u_2, \dots, u_j)\\
\end{eqnarray*}
For the last case, the QWTBvar will do $i\times j$ calculations (or more if other quantities will be varied).

\subsection{Example with vector quantity}
Consider scalar input quantity \li{x}:
\begin{eqnarray*}
    \text{\textsf{.v}:} & (v_1, v_2, \dots, v_i)\\
\end{eqnarray*}
\li{datainvar} must be of following:
\begin{eqnarray*}
    \text{\textsf{.v}:} & \left(    \begin{array}{ccc}
                                            v_{11}  & \hdots & v_{1j} \\
                                            \vdots  & \ddots & \vdots \\
                                            v_{i1}  & \hdots & v_{ij} \\
                                    \end{array}\right) \\
\end{eqnarray*}
QWTBvar will do $j$ calculations.

\section{Outputs of QWTBvar {\tt ndres}, {\tt ndresc}, {\tt ndaxis}}
\label{S:QWTBvar:ndres}
The outputs of the QWTBvar calculations are the output quantities of the used
algorithm or user function. The outputs are in a form of n-dimensional
matrices, where every dimension of the matrix is related to one varied input
quantity.

\subsection{\tt ndres}
Structure \li{ndres} contains all output quantities as matrices.

As an example, consider calculation with varied input quantities \li{x.v} ($i$ elements),
\li{y.v} ($j$ elements), \li{a.v} ($k$ elements), \li{a.u} ($l$ elements), and
scalar output quantity \li{z.v}. QWTBvar proceeded $i\times j\times k\times l$
calculations.

The \li{ndres} structure contains field of quantity \li{z}, that contains field value \li{.v},
that contains 4-dimensional matrix $Z$:
\begin{equation}
    \text{\textsf{ndres.z.v}} = \underset{i\times j\times k\times l}{Z},
\end{equation}
where dimensions of the $Z$ are $i,j,k,l$.
If the output quantity $z$ is not scalar, but vector or more, the \li{ndres.z.v} contains a cell of dimensions $i,j,k,l$.

\subsection{\tt ndresc}
The \li{ndresc} cell contains cell of structures. Each cell element
contains a structure with all output quantities. 

For the previous example, the
size of the cell \li{ndresc} dimensions are $i,j,k,l$. Each cell element
\li{ndresc{i,j,k,l}} contains a structure with value of \li{z.v}:
\begin{equation}
    \text{\textsf{ndresc\{i,j,k,l\}.z.v}} = Z_{i,j,k,l} .
\end{equation}

\subsection{\tt ndaxes}
This structure describes dimensions of n-dimensional matrix \li{ndres} or 
n-dimensional cell \li{ndresc}.

Fields of the structure are:
\begin{description}[itemsep=-0.5em]
    \item [\textsf{.names}] --- Full names of varied quantities.
    \item [\textsf{.values}] --- Values of varied quantities in a matrix.
    \item [\textsf{.valuesc}] --- Values of varied quantities in a cell. 
    \item [\textsf{.Q}] --- Names of varied quantities.
    \item [\textsf{.f}] --- Fields of varied quantities.
\end{description}

\subsubsection{\textsf{.names}}
Cell of strings. Full names of varied quantities. Example:
\begin{lstlisting}
    ndaxes.names = {'x.v', 'y.v', 'a.v', 'a.u'}
\end{lstlisting}

\subsubsection{\textsf{.values}}
Cell of values of the varied quantities. The values are matrix for scalar
values, cells for other (in the last case the quantity \li{.values} is
identical to a \li{.valuesc}). First value of \li{.values} cell represent a
varied quantity listed first in \li{.names} etc.

\subsubsection{\textsf{.valuesc}}
Cell of cells with values of the varied quantities. First value of \li{.values}
cell represent a varied quantity listed first in \li{.names} etc.

\subsubsection{\textsf{.Q}}
Cell of strings. Quantity name of the varied quantity. Part of the \li{.names}. Example:
\begin{lstlisting}
    ndaxes.Q = {'x', 'y', 'a', 'a'}
\end{lstlisting}

\subsubsection{\textsf{.f}}
Cell of strings. Field name of the varied quantity. Part of the \li{.names}. Example:
\begin{lstlisting}
    ndaxes.Q = {'v', 'v', 'v', 'u'}
\end{lstlisting}

\section{Structure with constants \tt consts}
\label{S:QWTBvar:consts}
The structure is used to limit the results in the outputs to a selected subset.
The results are sliced through the n-dimensional matrices at points selected in
\li{consts}. The structure should contain one or more quantities in the same
way as in \li{datain}. The quantities and values of the quantities has to be
one of the \li{datainvar}.

Example: consider calculations proceeded with following \li{datainvar}:
\begin{lstlisting}
datainvar.a.v = [1 2];
datainvar.a.u = [0 0.25 0.5];
datainvar.x.v = [-5  -2   0   2   5];
datainvar.y.v = [-5; -3; -1;  1;  3;  5];
\end{lstlisting}

The output quantities got dimensions $2\times 3\times 5\times 6$.
Following value of \li{consts}
\begin{lstlisting}
consts.a.v = 1;
consts.x.v = -2;
\end{lstlisting}
limit output results and/or figures to dimensions $3\times 6$.

\section{Output structure with plot data}
\label{S:QWTBvar:plotdata}
The outputs of the QWTBvar, when used in mode \li{'plot2D'} or \li{'plot3D'}
(see~\ref{S:QWTBvar:plot2D} or~\ref{S:QWTBvar:plot3D}), 
is a structure with following fields:
\begin{description}[itemsep=-0.5em]
    \item [\textsf{.name}] --- Full name of the plotted quantity.
    \item [\textsf{.data}] --- Values of the plotted quantity.
    \item [\textsf{.bars}] --- Values of the plotted error bars.
    \item [\textsf{.lbl}] --- Label of the axis.
    \item [\textsf{.ticklbl}] --- Labels for plot ticks.
    \item [\textsf{.Q}] --- Name of the plotted quantity.
    \item [\textsf{.f}] --- Field of the plotted quantity.
    \item [\textsf{.uncbar}] --- Nonzero if error bars are to be plotted.
\end{description}

\section{Structure for look-up table axis properties \tt axset}
2DO % XXX 
\section{Structure for look-up table XXXxxxxxxxxxxxx \tt rqset}
2DO % XXX 
\section{Structure for look-up table interpolation \tt ipoint}
2DO % XXX 


\chapter{Licensing} %<<<1 ----------------------------------------
\label{ch-license}
Every algorithm has its own license. License of every algorithm is placed in the directory of the
algorithm in a file named {\tt LICENSE.txt}. Type of the license is included in the algorithm information structure, see
chapter \ref{structalginfo}. The license of an algorithm can be displayed by following syntax:
\begin{lstlisting}
license = qwtb('algid', 'license')
\end{lstlisting}

The license of the toolbox itself is MIT License, please see file {\tt LICENSE.txt} in the directory
containing script {\tt qwtb.m}.

\chapter{QWTBLVLib \& simple QWTB GUI} %<<<1 ----------------------------------------
\section{QWTBLVLib} %<<<2 ----------------------------------------
QWTBLVLib is a set of \labview Virtual Instruments (VI) forming a library and providing an easy link
between \labview and QWTB. It uses {\em MATLAB Script
Node} to make {\em ActiveX} calls to \matlab and run QWTB. In future a use of {\sc GOLPI} is intended to run QWTB
by means of \octave.

Description of particular VIs and example of use is a part of the library.
Following figure shows the content of {\tt VI Tree.vi}.

\begin{center}
        \includegraphics[width=\textwidth]{sources/QWTBLVLib-vitree.png}
\end{center}

\section{simple QWTB GUI} %<<<2 ----------------------------------------
simple QWTB GUI (Graphical User Interface) is a fully working example of using QWTBLVLib written in \labview.
User can browse available algorithms and its descriptions, load or simulate data, run calculations
with selected algorithm and view results.

See following figure with a screen shot of the Simple QWTB GUI.

\begin{center}
        \includegraphics[width=\textwidth]{sources/simpleQWTBGUI.png}
\end{center}

After a start of simple QWTB GUI a window with several buttons is shown. To show
a window with a list of input quantities, to set input quantities or to generate input quantities
press button {\tt Show Input Quantities}. To list of available algorithms and algorithm informations
or to select algorithm press button
{\tt Show Algorithms}. To set calculation settings or GUI settings pres  button {\tt Show Settings}.
To run calculation with set input quantities and selected algorithm press  button {\tt Calculate!}.
To view output quantities press button {\tt Show Output Quantities}. To quit the simple QWTB
GUI press button {\tt QUIT}.

The work flow is following. After the start user have to set the directory containing QWTB in window
{\tt Settings}. Next user have to set input quantities in window {\tt Input Quantities}. After selecting required
algorithm in window {\tt Algorithms} the user can pres button {\tt Calculate!}. The results can be
reviewed in window {\tt Output quantities}.


% Bibliography %<<<1 ------------------------------
%%\bibliographystyle{ieeetr}
\printbibliography[title={Bilbiography},heading={bibnumbered}]

\appendix \chapter{Quick reference} %<<<1 ------------------------------
\newpage
{\small \textbf{Toolbox use:}\\[-1.5em]
\begin{lstlisting}[basicstyle=\small]
                         [alginfo] = qwtb()
                           dataout = qwtb('algid', datain)
[dataout, datain, calcset] = qwtb('algid', datain)
                           dataout = qwtb('algid', datain, calcset)
[dataout, datain, calcset] = qwtb('algid', datain, calcset)
                                           qwtb('algid', 'example')
                                           qwtb('algid', 'test')
                            alginfo = qwtb('algid', 'info')
                                           qwtb('algid', 'addpath')
                                           qwtb('algid', 'rempath')
                            license = qwtb('algid', 'license')
\end{lstlisting}

\vskip-1.5em
\noindent \textbf{Algorithm informations structure (\ref{structalginfo}):}\\[-1.5em]
\begin{description}[itemsep=-0.5em]
        \item [\textsf{.id}] --- Designator of the algorithm (\ref{structalginfoid})
        \item [\textsf{.name}] ---  Name of the algorithm (\ref{structalginfoname}).
        \item [\textsf{.desc}] ---  Basic description (\ref{structalginfodesc}).
        \item [\textsf{.citation}] ---  Reference (\ref{structalginfocitation}).
        \item [\textsf{.remarks}] ---  Any remark (\ref{structalginforemarks}).
        \item [\textsf{.license}] ---  License of the algorithm (\ref{structalginfolicense}).
        \item [\textsf{.inputs}] ---  Input quantities definitions (\ref{structalginfoinputs}).
        \item [\textsf{.outputs}] ---  Output quantities definitions (\ref{structalginfooutputs}).
        \item [\textsf{.providesGUF}] ---  Algorithm/wrapper calculates GUF uncertainty (\ref{structalginfoprovidesGUF}).
        \item [\textsf{.providesMCM}] ---  Algorithm/wrapper calculates MCM uncertainty (\ref{structalginfoprovidesMCM}).
        \item [\textsf{.fullpath}] ---  Full path to the algorithm. Automatically generated by the
        toolbox (\ref{structalginfofullpath}).
\end{description}
\textbf{Quantity structure (\ref{structquantity}):}\\[-1.5em]
\begin{description}[itemsep=-0.5em]
        \item [\textsf{.v}] --- Value (\ref{structquantityv}).
        \item [\textsf{.u}] --- Uncertainty (\ref{structquantityu}).
        \item [\textsf{.d}] --- Degree of freedom (\ref{structquantityd}).
        \item [\textsf{.c}] --- Correlation (\ref{structquantityc}).
        \item [\textsf{.r}] --- Randomized uncertainty (\ref{structquantityr}).
\end{description}
\textbf{Calculation settings structure (\ref{structcalcset}):}\\[-1.5em]
\begin{description}[itemsep=-0.5em]
        \item [\textsf{.strict}] ---  (0) If zero, other fields generated automatically
        (\ref{structcalcsetstrict}).
        \item [\textsf{.verbose}] ---  (1) Display various informations (\ref{structcalcsetverbose}).
        \item [\textsf{.unc}] ---  ('none') How uncertainty is calculated ('none', 'guf', 'mcm')
        (\ref{structcalcsetunc}).
        \item [\textsf{.loc}] ---  (0.6827) Required level of confidence of output uncertainties (0, 1)
        (\ref{structcalcsetloc}).
        \item [\textsf{.cor.req}] ---  (0) Correlation matrix is required for all input quantities
        (\ref{structcalcsetcor}).
        \item [\textsf{.cor.gen}] ---  (1) Zero correlation matrix is generated automatically if
        missing (\ref{structcalcsetcor}).
        \item [\textsf{.dof.req}] ---  (0) Degrees of freedom are required for all input quantities
        (\ref{structcalcsetdof}).
        \item [\textsf{.dof.gen}] ---  (1) Degree of freedom are generated automat. if missing
        with value 50 (\ref{structcalcsetdof}).
        \item [\textsf{.mcm.repeats}] ---  (100) Number of Monte Carlo iterations
        (\ref{structcalcsetmcm}).
        \item [\textsf{.mcm.verbose}] ---  (1) Display various informations concerning Monte Carlo
        method (\ref{structcalcsetmcm}).
        \item [\textsf{.mcm.method}] ---  ('singlecore') Parallelization method ('multicore',
        'multistation') (\ref{structcalcsetmcm}).
        \item [\textsf{.mcm.procno}] ---  (0) Number of processors to use (\ref{structcalcsetmcm}).
        \item [\textsf{.mcm.tmpdir}] ---  ('.') Directory for temporary data
        (\ref{structcalcsetmcm}).
        \item [\textsf{.mcm.randomize}] ---  (1) Randomized uncert. are generated
        automat. if missing (\ref{structcalcsetmcm}).
\end{description}
}

\chapter{Simple example of QWTB use} %<<<1 ----------------------------------
\input{qwtb_examples_published/qwtb_example_1.tex}

\chapter{Long example of QWTB use} %<<<1 ----------------------------------
\input{qwtb_examples_published/qwtb_example_2.tex}

\end{document}

% vim settings: vim:foldmarker=%<<<,%>>> fdm=marker fen
% \chapter{Simple example of QWTBvar use} %<<<1 ----------------------------------
% 2DO XXX
% % \input{qwtb_examples_published/qwtbvar_example_1.tex}
% This example is shown in a file \li{qwtbvar_example_1.m}.
%
%
% \chapter{Complex example of QWTBvar use with non-scalar quantities} %<<<1 ----------------------------------
% 2DO XXX
